<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-8">My Profile</h1>

    <!-- Account Status Section - ADDED AT THE TOP -->
    <div class="mb-8">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-semibold text-gray-900">Account Status</h2>
            <%= current_user.verified_badge %>
        </div>

        <% unless current_user.email_verified? %>
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-blue-800">
                        Email Verification Required
                    </h3>
                    <div class="mt-2 text-sm text-blue-700">
                        <p>Verify your email to unlock all features:</p>
                        <ul class="list-disc list-inside mt-1">
                            <li>Place orders and make purchases</li>
                            <li>Chat with support team</li>
                            <li>Access order history</li>
                        </ul>
                    </div>
                    <div class="mt-3">
                        <%= link_to 'Verify Email Now', verification_path, 
                                  class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700" %>
                        <%= button_to 'Resend Verification Code', 
                                  resend_verification_path, 
                                  method: :post,
                                  class: "ml-3 inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50" %>
                    </div>
                </div>
            </div>
        </div>
        <% end %>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Profile Info -->
        <div class="lg:col-span-1">
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="text-center">
                    <% if @user.avatar.attached? %>
                    <%= image_tag @user.avatar, class: "w-32 h-32 rounded-full mx-auto mb-4 object-cover" %>
                    <% else %>
                    <div class="w-32 h-32 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i data-lucide="user" class="h-16 w-16 text-green-600"></i>
                    </div>
                    <% end %>

                    <h2 class="text-xl font-semibold text-gray-900"><%= @user.name %></h2>
                    <p class="text-gray-600"><%= @user.email %></p>
                    <p class="text-gray-500 text-sm mt-2">
                        <i data-lucide="map-pin" class="h-4 w-4 inline mr-1"></i>
                        <%= @user.location %>
                    </p>
                    <div class="flex flex-col items-center space-y-3">
                        <span class="inline-block mt-2 px-3 py-1 bg-<%= current_user.supplier? ? 'green' : 'blue' %>-100 text-<%= current_user.supplier? ? 'green' : 'blue' %>-800 text-sm font-medium rounded-full">
                            <%= current_user.role.titleize %>
                        </span>
                    </div>
                    <%= link_to "Edit Profile", edit_user_path(@user), 
                class: "mt-4 inline-block bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors" %>
                </div>
            </div>
        </div>

        <!-- Orders & Products -->
        <div class="lg:col-span-2 space-y-8">
            <!-- Recent Orders -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Recent Orders</h3>

                <% if @orders.any? %>
                <div class="space-y-4">
                    <% @orders.limit(5).each do |order| %>
                    <div class="flex items-center justify-between border-b pb-4 last:border-b-0">
                        <div>
                            <p class="font-medium text-gray-900">Order #<%= order.id %></p>
                            <p class="text-sm text-gray-600">
                                <%= order.created_at.strftime("%B %d, %Y") %> •
                                <span class="capitalize <%= order.status == 'confirmed' ? 'text-green-600' : 'text-gray-600' %>">
                                    <%= order.status %>
                                </span>
                            </p>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold text-gray-900">£<%= order.total_amount %></p>
                            <%= link_to "View", order_path(order), class: "text-green-600 hover:text-green-700 text-sm" %>
                        </div>
                    </div>
                    <% end %>
                </div>

                <%= link_to "View All Orders", orders_path, 
                class: "mt-4 inline-block text-green-600 hover:text-green-700 font-medium" %>
                <% else %>
                <p class="text-gray-500 text-center py-4">No orders yet.</p>
                <%= link_to "Start Shopping", products_path, 
                class: "inline-block bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors" %>
                <% end %>
            </div>

            <!-- My Products (if supplier) -->
            <% if @user.products.any? %>
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">My Products</h3>
                    <%= link_to "Add New", new_product_path, 
                  class: "bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors" %>
                </div>

                <div class="space-y-4">
                    <% @user.products.limit(3).each do |product| %>
                    <div class="flex items-center space-x-4 border-b pb-4 last:border-b-0">
                        <% if product.primary_image %>
                        <%= image_tag product.primary_image, class: "w-16 h-16 object-cover rounded-lg" %>
                        <% else %>
                        <div class="w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center">
                            <span class="text-xl"><%= product.category_icon %></span>
                        </div>
                        <% end %>

                        <div class="flex-1">
                            <h4 class="font-medium text-gray-900"><%= product.name %></h4>
                            <p class="text-sm text-gray-600">
                                £<%= product.price %> / <%= product.unit %> •
                                <span class="<%= product.in_stock? ? 'text-green-600' : 'text-red-600' %>">
                                    <%= product.in_stock? ? 'In Stock' : 'Out of Stock' %>
                                </span>
                            </p>
                        </div>

                        <%= link_to "Edit", edit_product_path(product), class: "text-green-600 hover:text-green-700 text-sm" %>
                    </div>
                    <% end %>
                </div>

                <%= link_to "View All Products", products_path(user_id: @user.id), 
                class: "mt-4 inline-block text-green-600 hover:text-green-700 font-medium" %>
            </div>
            <% end %>
        </div>
    </div>
</div>