<div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
    <!-- Breadcrumb -->
    <nav class="flex mb-6" aria-label="Breadcrumb">
        <ol class="flex items-center space-x-4">
            <li>
                <%= link_to root_path, class: "text-gray-500 hover:text-gray-700" do %>
                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                </svg>
                <% end %>
            </li>
            <li>
                <svg class="h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </li>
            <li>
                <%= link_to admin_dashboard_path, class: "text-gray-500 hover:text-gray-700" do %>
                Admin
                <% end %>
            </li>
            <li>
                <svg class="h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </li>
            <li class="text-gray-900 font-medium">
                Dashboard
            </li>
        </ol>
    </nav>
    <!-- Header -->
    <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center gap-6 mb-8">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">Admin Dashboard</h1>
            <p class="text-gray-600 mt-2">Operations overview • No payments collected on-platform</p>
        </div>
        <div class="flex flex-wrap gap-3">
            <%= link_to 'Users', admin_users_path, class: "bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md font-medium w-full sm:w-auto text-center" %>
            <%= link_to 'Products', admin_products_path, class: "bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md font-medium w-full sm:w-auto text-center" %>
            <%= link_to 'Quotation Requests', admin_quotation_requests_path, class: "bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md font-medium w-full sm:w-auto text-center" %>
            <%= link_to 'Reviews', admin_reviews_path, class: "bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md font-medium w-full sm:w-auto text-center" %>
            <%= link_to 'Support', support_dashboard_path, class: "bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md font-medium w-full sm:w-auto text-center" %>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6 mb-8">
        <div class="bg-white p-6 rounded-lg shadow-sm">
            <h3 class="text-sm font-semibold text-gray-500">Total Users</h3>
            <p class="text-3xl font-bold text-gray-900"><%= @users_count %></p>
            <p class="text-xs text-gray-500 mt-1"><%= @buyers_count %> buyers • <%= @suppliers_count %> suppliers</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-sm">
            <h3 class="text-sm font-semibold text-gray-500">Products</h3>
            <p class="text-3xl font-bold text-gray-900"><%= @products_count %></p>
            <p class="text-xs text-gray-500 mt-1"><%= @in_stock_count %> in stock • <%= @out_of_stock_count %> out</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-sm">
            <h3 class="text-sm font-semibold text-gray-500">Quotation Requests</h3>
            <p class="text-3xl font-bold text-gray-900"><%= @quotation_requests_count %></p>
            <p class="text-xs text-gray-500 mt-1">Requests recorded (no payments)</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-sm">
            <h3 class="text-sm font-semibold text-gray-500">Verification Rate</h3>
            <p class="text-3xl font-bold text-gray-900"><%= @verification_rate %>%</p>
            <p class="text-xs text-gray-500 mt-1"><%= @unverified_users %> unverified</p>
        </div>
    </div>

        <!-- Charts -->
                        <div class="grid grid-cols-1 xl:grid-cols-3 gap-8 mb-8">
        <div class="bg-white p-6 rounded-lg shadow-sm xl:col-span-2">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-semibold text-gray-900">User Signups (30 days)</h2>
                <span class="text-xs text-gray-500">Server-rendered</span>
            </div>
            <% signup_max = [@signup_series&.max.to_i, 1].max %>
            <div class="h-56 sm:h-64 lg:h-72 flex items-end gap-1 border-b border-l border-gray-200 px-2 pb-2">
                <% (@signup_series || []).each do |value| %>
                    <% bar_height = ((value.to_f / signup_max) * 100).round %>
                    <div class="flex-1 bg-green-500/70 rounded-t" style="height: <%= [bar_height, 2].max %>%"></div>
                <% end %>
            </div>
            <p class="text-xs text-gray-500 mt-2">Max daily signups: <%= signup_max %></p>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-sm">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-semibold text-gray-900">Product Categories (30 days)</h2>
                <span class="text-xs text-gray-500">Server-rendered</span>
            </div>
            <% category_totals = (@category_series || {}).transform_values { |series| Array(series).sum } %>
            <% category_max = [category_totals.values.max.to_i, 1].max %>
            <div class="space-y-3 h-56 sm:h-64 lg:h-72 overflow-y-auto pr-1">
                <% if category_totals.any? %>
                    <% category_totals.each do |category, total| %>
                        <% width_pct = ((total.to_f / category_max) * 100).round %>
                        <div>
                            <div class="flex items-center justify-between text-xs text-gray-600 mb-1">
                                <span><%= category.presence || "Uncategorized" %></span>
                                <span><%= total %></span>
                            </div>
                            <div class="w-full h-2 bg-gray-100 rounded">
                                <div class="h-2 bg-green-600 rounded" style="width: <%= [width_pct, 2].max %>%"></div>
                            </div>
                        </div>
                    <% end %>
                <% else %>
                    <p class="text-sm text-gray-500">No category activity in the last 30 days.</p>
                <% end %>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 xl:grid-cols-3 gap-8 mb-8">
        <div class="bg-white p-6 rounded-lg shadow-sm xl:col-span-2">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-semibold text-gray-900">Most Visited Pages (30 days)</h2>
                <span class="text-xs text-gray-500">Server-rendered</span>
            </div>
            <% page_totals = (@pageview_series || {}).transform_values { |series| Array(series).sum } %>
            <% page_max = [page_totals.values.max.to_i, 1].max %>
            <div class="space-y-3 h-56 sm:h-64 lg:h-72 overflow-y-auto pr-1">
                <% if page_totals.any? %>
                    <% page_totals.each do |path, total| %>
                        <% width_pct = ((total.to_f / page_max) * 100).round %>
                        <div>
                            <div class="flex items-center justify-between text-xs text-gray-600 mb-1">
                                <span class="truncate max-w-[80%]"><%= path %></span>
                                <span><%= total %></span>
                            </div>
                            <div class="w-full h-2 bg-gray-100 rounded">
                                <div class="h-2 bg-blue-600 rounded" style="width: <%= [width_pct, 2].max %>%"></div>
                            </div>
                        </div>
                    <% end %>
                <% else %>
                    <p class="text-sm text-gray-500">No page view data in the last 30 days.</p>
                <% end %>
            </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-sm">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-semibold text-gray-900">Support & Reviews</h2>
            </div>
            <div class="space-y-4">
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-600">Support messages</span>
                    <span class="text-sm font-semibold text-gray-900"><%= @support_messages_count %></span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-600">Reviews</span>
                    <span class="text-sm font-semibold text-gray-900"><%= @reviews_count %></span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-600">Flagged reviews</span>
                    <span class="text-sm font-semibold text-gray-900"><%= @flagged_reviews %></span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-600">Pending product verifications</span>
                    <span class="text-sm font-semibold text-gray-900"><%= @pending_verifications %></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
        <div class="bg-white p-6 rounded-lg shadow-sm">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">Recent Quotation Requests</h2>
            <% if @recent_quotation_requests.any? %>
            <div class="space-y-4">
                <% @recent_quotation_requests.each do |request| %>
                <div class="border-b pb-4 last:border-b-0">
                    <p class="font-medium">Request #<%= request.id %></p>
                    <p class="text-gray-600">By <%= request.user.name %></p>
                    <p class="text-xs text-gray-500"><%= request.created_at.strftime("%b %d, %Y") %></p>
                    <p class="text-xs text-gray-500">Requested via: <%= request.requested_via.to_s.titleize %></p>
                </div>
                <% end %>
            </div>
            <% else %>
            <p class="text-gray-500">No recent quotation requests</p>
            <% end %>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-sm">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">Recent Products</h2>
            <% if @recent_products.any? %>
            <div class="space-y-4">
                <% @recent_products.each do |product| %>
                <div class="border-b pb-4 last:border-b-0">
                    <p class="font-medium"><%= product.name %></p>
                    <p class="text-gray-600">By <%= product.user.name %></p>
                    <p class="text-xs text-gray-500"><%= product.created_at.strftime("%b %d, %Y") %></p>
                </div>
                <% end %>
            </div>
            <% else %>
            <p class="text-gray-500">No recent products</p>
            <% end %>
        </div>
    </div>
    </div>