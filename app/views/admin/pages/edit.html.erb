<%= content_for :head do %>
  <style>
    #html-editor {
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 14px;
      line-height: 1.5;
      tab-size: 2;
    }
    #preview-container {
      min-height: 400px;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      padding: 1rem;
      background: white;
      overflow: auto;
    }
  </style>
<% end %>

<div class="min-h-screen bg-gray-50 py-12">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="bg-white rounded-xl shadow-sm p-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-6">Edit <%= @page.title %></h1>

            <%= form_with model: [:admin, @page], local: true, id: 'page-form', data: { turbo: false } do |form| %>
            <div class="mb-6">
                <%= form.label :title, class: 'block text-sm font-medium text-gray-700 mb-2' %>
                <%= form.text_field :title, 
                class: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-lg' %>
            </div>

            <div class="mb-6">
                <div class="flex items-center justify-between mb-2">
                    <%= form.label :content, class: 'block text-sm font-medium text-gray-700' %>
                    <div class="flex space-x-2">
                        <button type="button" id="html-mode-btn" class="px-3 py-1 text-sm rounded-md bg-green-600 text-white">
                            HTML Code
                        </button>
                        <button type="button" id="preview-mode-btn" class="px-3 py-1 text-sm rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300">
                            Preview
                        </button>
                    </div>
                </div>
                
                <!-- HTML Editor Mode -->
                <div id="html-editor-container">
                    <%= form.text_area :content, rows: 25, id: 'html-editor',
                    class: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500' %>
                </div>
                
                <!-- Preview Mode (hidden by default) -->
                <div id="preview-container" class="hidden">
                </div>
                
                <p class="text-sm text-gray-500 mt-2">
                    <strong>HTML Code mode:</strong> Edit raw HTML with Tailwind CSS classes preserved.
                    <strong>Preview:</strong> See how the page will look.
                </p>
            </div>

            <div class="flex items-center justify-end space-x-4 pt-6 border-t">
                <%= link_to 'Cancel', send("#{@page.slug.underscore}_path"), 
                class: "bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors" %>
                <%= form.submit 'Update Page', 
                class: "bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors cursor-pointer" %>
            </div>
            <% end %>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var htmlEditor = document.getElementById('html-editor');
    var htmlEditorContainer = document.getElementById('html-editor-container');
    var previewContainer = document.getElementById('preview-container');
    var htmlModeBtn = document.getElementById('html-mode-btn');
    var previewModeBtn = document.getElementById('preview-mode-btn');

    // Switch to HTML mode
    htmlModeBtn.addEventListener('click', function() {
        htmlEditorContainer.classList.remove('hidden');
        previewContainer.classList.add('hidden');
        htmlModeBtn.classList.remove('bg-gray-200', 'text-gray-700');
        htmlModeBtn.classList.add('bg-green-600', 'text-white');
        previewModeBtn.classList.remove('bg-green-600', 'text-white');
        previewModeBtn.classList.add('bg-gray-200', 'text-gray-700');
    });

    // Switch to Preview mode
    previewModeBtn.addEventListener('click', function() {
        htmlEditorContainer.classList.add('hidden');
        previewContainer.classList.remove('hidden');
        previewContainer.innerHTML = htmlEditor.value;
        previewModeBtn.classList.remove('bg-gray-200', 'text-gray-700');
        previewModeBtn.classList.add('bg-green-600', 'text-white');
        htmlModeBtn.classList.remove('bg-green-600', 'text-white');
        htmlModeBtn.classList.add('bg-gray-200', 'text-gray-700');
        
        // Re-initialize Lucide icons in preview
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }
    });
});
</script>