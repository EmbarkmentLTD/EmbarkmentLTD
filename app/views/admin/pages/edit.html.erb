<%= content_for :head do %>
  <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
  <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
  <style>
    .ql-editor { min-height: 400px; font-size: 16px; }
    .ql-toolbar.ql-snow { border-top-left-radius: 0.5rem; border-top-right-radius: 0.5rem; }
    .ql-container.ql-snow { border-bottom-left-radius: 0.5rem; border-bottom-right-radius: 0.5rem; }
  </style>
<% end %>

<div class="min-h-screen bg-gray-50 py-12">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="bg-white rounded-xl shadow-sm p-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-6">Edit <%= @page.title %></h1>

            <%= form_with model: [:admin, @page], local: true, id: 'page-form' do |form| %>
            <div class="mb-6">
                <%= form.label :title, class: 'block text-sm font-medium text-gray-700 mb-2' %>
                <%= form.text_field :title, 
                class: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-lg' %>
            </div>

            <div class="mb-6">
                <%= form.label :content, class: 'block text-sm font-medium text-gray-700 mb-2' %>
                <div id="quill-editor"><%= raw @page.content %></div>
                <%= form.hidden_field :content, id: 'page_content_hidden' %>
                <p class="text-sm text-gray-500 mt-2">
                    Use the toolbar above to format your content.
                </p>
            </div>

            <div class="flex items-center justify-end space-x-4 pt-6 border-t">
                <%= link_to 'Cancel', send("#{@page.slug.underscore}_path"), 
                class: "bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors" %>
                <%= form.submit 'Update Page', 
                class: "bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors cursor-pointer" %>
            </div>
            <% end %>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var quill = new Quill('#quill-editor', {
        theme: 'snow',
        modules: {
            toolbar: [
                [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
                ['bold', 'italic', 'underline', 'strike'],
                [{ 'color': [] }, { 'background': [] }],
                [{ 'align': [] }],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                [{ 'indent': '-1'}, { 'indent': '+1' }],
                ['link', 'image'],
                ['blockquote', 'code-block'],
                ['clean']
            ]
        }
    });

    // Sync Quill content to hidden field before form submit
    var form = document.getElementById('page-form');
    form.addEventListener('submit', function(e) {
        var hiddenField = document.getElementById('page_content_hidden');
        hiddenField.value = quill.root.innerHTML;
    });
});
</script>